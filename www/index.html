<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasklist AMS2</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
    <style>
        .tasca {
            margin: 8px;
            padding: 8px;
            border: 2px solid black;
            border-radius: 8px;
        }
        #dialog {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Tasklist</h1>
    <div id="list">
        <div class="tasca">
            <span class="nom">test task</span>
            <button class="edita" onclick="edita()">Edita</button>
            <button class="elimina" onclick="elimina()">&times;</button>
        </div>
    </div>
    <div id="dialog">
        Nom de la tasca:
        <input type="text"/>
    </div>
    <button onClick="afegeix()">Afegeix</button>
    <script>
        function afegeix() {
            $("#dialog").dialog({
                resizable: false,
                height: "auto",
                width: 400,
                modal: true,
                buttons: {
                    "Afegir tasca": function() {
                        const taskname = $('input').val();
                        
                        const elem = $(
                            '<div class="tasca">' + 
                                '<span class="nom">'+taskname+'</span>' +
                                '<button class="edita">Edita</button>' +
                                '<button class="elimina">&times;</button>' +
                            '</div>');
                        $(".edita", elem).click(edita);
                        $(".elimina", elem).click(elimina);
                        $('#list').append(elem);
                        
                        $('input').val("");
                        $(this).dialog("close");
                    },
                    Cancel: function() {
                    $('input').val("");
                    $(this).dialog("close");
                    }
                }
             });
        }
        function elimina(event) {
            var caller = event.target || event.srcElement;
            $(caller).parent().remove();
        }
        function edita(event) {
            var caller = event.target || event.srcElement;
            $("#dialog").dialog({
                resizable: false,
                height: "auto",
                width: 400,
                modal: true,
                buttons: {
                    "Editar tasca": function() {
                        const taskname = $('input').val();
                        
                        $(caller).parent().find('.nom').text(taskname);

                        $('input').val("");
                        $(this).dialog("close");
                    },
                    Cancel: function() {
                    $('input').val("");
                    $(this).dialog("close");
                    }
                }
            });
        }
    </script>
</body>
</html>